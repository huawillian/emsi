<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-app.html">
<link rel="import" href="../../bower_components/google-map/google-map-directions.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/iron-collapse/iron-collapse.html">

<dom-module id="emsi-church-paper-card">
	<template>
		<style>
			:host {
				display: block;
			}

			paper-card {
				width:80%;
				margin-left: 10%;
				margin-right: 10%;
				margin-top: 10px;
				padding: 10px;
				color: black;
			}
		</style>
      <google-map-directions id="dir"
          start-address=""
          end-address="{{address}}"
          response="{{data}}" 
          api-key="AIzaSyCmbUbEOc5qc59PyjgmM0kASRC9eS9JsDk"></google-map-directions>

		<paper-card heading="{{city}}">
		  <div class="card-content">
		    <h3> {{address}}</h3>
		    <h3> {{sundayServiceTime}}</h3>
		    <h3> {{userDistanceText}}</h3>
		  </div>
		  <div class="card-actions">
		  	<paper-button> Get Directions </paper-button>
		    <paper-button> Learn More </paper-button>
		  </div>
		</paper-card>

	</template>
	<script>
		Polymer({
			is: 'emsi-church-paper-card',

			properties: {
				city: {
					type: String,
					value: "Towaco"
				} ,
				address: {
					type: String,
					value: "36 Alpine Road, Towaco, NJ 07082"
				} ,
				sundayServiceTime: {
					type: String,
					value: "Sunday at 10:30am to 11:50am"
				} , 
				learnMoreUrl: {
					type: String,
					value: "towaco"
				} ,
				data: {
				  type: Object,
				  value: {},
				  observer: "responseChanged"
				} ,
				userLocation: {
					type: String,
					value: "",
					observer: "userLocationChanged"
				} , 
				userDistance: {
					type: Object,
					value: {},
					observer: "distanceUpdated"
				} ,
				userDistanceText: String
			},

			distanceUpdated: function(newValue) {
				if(newValue == {}) return;
				var param = {};
				param.name = this.city;
				param.distance = newValue;
				this.fire('distance-updated', param);
			} ,

			responseChanged: function(newValue, oldValue) {
				if(oldValue == undefined) return;
				if(this.userLocation != "") {
					this.userDistance = newValue.routes[0].legs[0].distance;
					this.$.dir.startAddress = "";
				}
			} ,

			created: function() {
				//this.getLocation();
			} ,

			userLocationChanged: function(newValue) {
				if(newValue == "") return;
				this.$.dir.startAddress = newValue;
			} ,

			getLocation: function() {
				if (navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(function(position){
						this.userLocation = position.coords.latitude + " " + position.coords.longitude;
					}.bind(this));
				}
			} ,
		});
	</script>
</dom-module>