<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../../bower_components/paper-menu-button/paper-menu-button.html">

<!-- custom styles -->
<link rel="import" href="../../styles/navbar-desktop-styles.html">

<dom-module id="emsi-navbar-desktop">
	<template>
		<style include="navbar-desktop-styles"> </style>
		<div class="container">

			<template is="dom-repeat" items="[[menuContent]]" as="menu" index-as="i">
	      <paper-menu-button class="navbuttons" on-mouseenter="openSubMenu" on-mouseleave="closeAllMenus" style$="left:{{computeLeft(i)}}pt" vertical-offset="55" horizontal-offset="8">
	      	<div slot="dropdown-trigger" class="menu-trigger">
	      		<template is="dom-if" if="[[isEnglish]]"> {{menu.en}} </template>
						<template is="dom-if" if="[[!isEnglish]]"> {{menu.zh}} </template>
	      	</div>
	      	<paper-listbox slot="dropdown-content" class="menu-content" selectable="none">
				    <template is="dom-repeat" items="[[menu.items]]" as="item" index-as="j">
					    <div on-tap="changeRoute" class="menu-trigger">
					    	<template is="dom-if" if="[[isEnglish]]"> {{item.en}} </template>
								<template is="dom-if" if="[[!isEnglish]]"> {{item.zh}} </template>
					  	</div>
				  	</template>
			  	</paper-listbox>
		  	</paper-menu-button>
			</template>
		</div>
	</template>

	<script>
		class EMSINavbarDesktop extends Polymer.Element {
			static get is() { return 'emsi-navbar-desktop'; }

			static get properties() {
				return {
					lang: String,
					isEnglish: Boolean,
					menuContent: {
						type: Array,
						value: [
							{
								en: "ABOUT US",
								zh: "? ABOUT US ?",
								items: [
									{
										en: "Organization",
										zh: "? Organization ?",
										route: "/home"
									},
									{
										en: "Beliefs",
										zh: "? Beliefs ?",
										route: "/beliefs"
									},
									{
										en: "Missions",
										zh: "? Missions ?",
										route: "/missions"
									},
									{
										en: "Seminary",
										zh: "? Seminary ?",
										route: "/seminary"
									},
								]
							},
							{
								en: "LOCATIONS",
								zh: "? LOCATIONS ?",
								items: [
									{
										en: "Search",
										zh: "? Search ?",
										route: "/search"
									},
									{
										en: "America",
										zh: "? America ?",
										route: "/america"
									},
									{
										en: "Europe",
										zh: "? Europe ?",
										route: "/europe"
									},
									{
										en: "Asia",
										zh: "? Asia ?",
										route: "/asia"
									},
									{
										en: "Africa",
										zh: "? Africa ?",
										route: "/africa"
									},
								]
							},
							{
								en: "MISSIONS",
								zh: "? MISSIONS ?",
								items: [
									{
										en: "Introduction",
										zh: "? Introduction ?",
										route: "missions"
									},
									{
										en: "Ministries",
										zh: "? Ministries ?",
										route: "/ministries"
									},
									{
										en: "Churches",
										zh: "? Churches ?",
										route: "/churches"
									},
									{
										en: "Activities",
										zh: "? Activities ?",
										route: "/activities"
									},
								]
							},
							{
								en: "SEMINARY",
								zh: "? SEMINARY ?",
								items: [
									{
										en: "Introduction",
										zh: "? Introduction ?",
										route: "seminary"
									},
									{
										en: "Courses",
										zh: "? Courses ?",
										route: "/courses"
									},
									{
										en: "Curriculum",
										zh: "? Curriculum ?",
										route: "/curriculum"
									}
								]
							},
						]
					}
				};
			}

			static get observers() { return [ 'languageChanged(lang)' ]; }

      languageChanged(val) {
      	this.isEnglish = val === "en";
      }

      computeLeft(i) {
      	return i * 90;
      }

			openSubMenu(e) {
				let submenuObj = Polymer.dom(e).localTarget;
				submenuObj.open();
			}

			closeAllMenus(e) {
				let submenuArr = Polymer.dom(this.root).querySelectorAll("paper-menu-button");
				submenuArr.forEach(v => v.close());			
			}

			changeRoute(e) {
				let menuIdx = e.model.parentModel.i;
				let itemIdx = e.model.j;
				this.dispatchEvent(new CustomEvent('emsi-route-change-event', { detail: this.menuContent[menuIdx].items[itemIdx].route, bubbles: true, composed: true }));
				this.closeAllMenus();
			}
		}

		window.customElements.define(EMSINavbarDesktop.is, EMSINavbarDesktop);
	</script>
</dom-module>