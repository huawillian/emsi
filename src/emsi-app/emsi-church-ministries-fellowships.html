<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">

<!-- custom elements -->
<link rel="import" href="emsi-button.html">
<link rel="import" href="emsi-firebase-document.html">

<dom-module id="emsi-church-ministries-fellowships">
	<template>
		<style>
			:host {
				display: block;
				margin: 0;
				padding: 0;
				margin-bottom: -4pt;
			}

			.container {
				width:100%;
				height: 50vw;
				background-color: white;
			}

			.title {
				color: #236192;
				font-size: 25pt;
				font-family: MyriadProBold;
				letter-spacing: 0px;
				text-align: left;
				margin-bottom: 15pt;
			}

			#serviceTitle {
				font-size: 14pt;
				color: rgba(0,0,0,0.6);
				font-family: MyriadProSemibold;
				padding-top: 5px;
			}

			#serviceContainer {
				font-size: 13pt;
				color: rgba(0,0,0,0.6);
				font-family: MyriadProRegular;
				width:100%;
				text-align: left;
				padding-bottom: 0px;
			}

			.container > table {
				width:100%; 
				height:100%; 
				text-align: left; 
				padding: 8%;
			}

			@media screen and (max-width: 800px) {
				.container {
					height:100vw
				}
			}

			@media screen and (max-width: 1000px) and (min-width: 800px) {
				.container > table {
					padding: 4%
				}

				.title {
					font-size: 30px;
					margin-bottom: 8pt;
				}

				#serviceTitle {
					font-size: 12pt;
				}

				#serviceContainer {
					font-size: 11pt;
				}
			}


			@media screen and (max-width: 800px) and (min-width: 500px){
				.container > table {
					padding: 8%;
				}

				.title {
					font-size: 25pt;
					margin-bottom: 15pt;
				}
			}

			@media screen and (max-width: 500px) {
				.container > table {
					padding: 4%;
				}

				.title {
					font-size: 26px;
					margin-bottom: 8pt;
				}

				#serviceTitle {
					font-size: 12pt;
				}

				#serviceContainer {
					font-size: 11pt;
					line-height: 1;
				}
			}

			paper-dialog {
				width: 80%;
				background-color: white;
			}

			emsi-button {
				margin-top: 10pt;
			}

			table {
				table-layout: fixed;
			}

			th, td {
	    	width: 50%;
			}

		</style>

		<div class="container">
			<table> 
				<tbody valign="top">
					<tr>
	    				<td>
							<div class="title"> {{title}} </div>
							<div class="content">
								<template is="dom-repeat" items="[[displayedData]]" as="section">
									<div id="serviceTitle"> {{section.language}} </div>
									<table id="serviceContainer">
										<template is="dom-repeat" items="[[section.list]]" as="item">
											<tr>
												<td>{{item.name}}</td> 
											    <td>{{item.time}}</td>
										  	</tr>
										</template>
									</table>
								</template>
							</div>

							<template is="dom-if" if="{{hasHiddenMinistries}}">
								<emsi-button color="blue" on-tap="showMore">
									<template is="dom-if" if="[[isEnglish]]">
										SHOW MORE
									</template>
									<template is="dom-if" if="[[!isEnglish]]">
										? CHINESE SHOW ?
									</template>
								</emsi-button>
					    </template>
						</td>
	    			</tr>
    			</tbody>
			</table>
		</div>

		<paper-dialog id="dialog" modal style="width: 80vw; padding: 10pt; padding-right: 0">
		  <div style="color: #236192; font-size: 22pt; font-family: MyriadProBold;"> {{title}} </div>
		  <paper-dialog-scrollable>
			<div class="content" style="color: rgba(0,0,0,0.6); font-size: 12pt; line-height: 1.5; font-family: MyriadProRegular;">
				<template is="dom-repeat" items="[[data]]" as="section">
					<div id="serviceTitle" style="font-size: 14pt; color: rgba(0,0,0,0.6); font-family: MyriadProSemibold; padding-top: 5px;"> {{section.language}} </div>
					<table id="serviceContainer" style="font-size: 13pt; color: rgba(0,0,0,0.6); font-family: MyriadProRegular; width:100%; text-align: left; padding-bottom: 0px;table-layout: fixed;">
						<template is="dom-repeat" items="[[section.list]]" as="item">
							<tr>
								<td style="width: 50%;">{{item.name}}</td> 
							    <td style="width: 50%;">{{item.time}}</td>
						  	</tr>
						</template>
					</table>
				</template>
			</div>
		  </paper-dialog-scrollable>
		  <div class="buttons">
		    <emsi-button color="blue" dialog-dismiss> CLOSE </emsi-button>
		  </div>
		</paper-dialog>
		
	</template>
	<script>
		class EMSIChurchMinistriesFellowships extends Polymer.Element {
			static get is() { return 'emsi-church-ministries-fellowships'; }

			static get properties() { 
				return {
					title: String,
					data: {
						type: Array,
						value: [],
						observer: "dataChanged"
					} ,
					displayedData: {
						type: Array,
						value: []
					} ,
					hasHiddenMinistries: {
						type: Boolean,
						value: false
					}
				}; 
			}

      static get observers() { return [ 'languageChanged(lang)' ]; }

      languageChanged(val) { this.isEnglish = val === "en"; }

			dataChanged(newValue, oldValue) {
				if(!newValue || newValue.length === 0) {
					return;
				}

				console.log(newValue);
				this.calculateHasHiddenMinistries(newValue);

				this.set("displayedData", []);

				for(var i = 0; i < 3; i++) {
					if(newValue[i] == undefined) break;

					var tempObj = {};
					tempObj.language = newValue[i].language;
					tempObj.list = [];

					for(var j = 0; j < 3; j++) {
						if(newValue[i].list[j] == undefined) break;
						tempObj.list[j] = newValue[i].list[j];
					}

					this.push("displayedData", tempObj);
				}

				console.log(this.displayedData);

			}

			calculateHasHiddenMinistries(data) {
				if(!data || data.length === 0) {
					this.hasHiddenMinistries = false;
					return;
				}
				
				this.hasHiddenMinistries = false;

				if(data.length > 3) {
					this.hasHiddenMinistries = true;
				}

				for(var i = 0; i < data.length; i++) {
					if(data[i].list.length > 3) {
						this.hasHiddenMinistries = true;
					}
				}
			}

			showMore() {
				var body = document.querySelector('body');
			  	Polymer.dom(body).appendChild(this.$.dialog);
			  	this.$.dialog.open();
			}
		}

		window.customElements.define(EMSIChurchMinistriesFellowships.is, EMSIChurchMinistriesFellowships);
	</script>
</dom-module>